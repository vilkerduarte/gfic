<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>Comparador de Hashs</title>
</head>

<body>
    <div class="w-screen h-screen flex">
        <div id="console" class="w-[200px] whitespace-pre overflow-auto bg-black text-white p-2">
        </div>
        <div class="flex-auto p-4">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold">Comparador de Hashs</h1>
                <div class="flex items-center gap-4">
                    <span id="current-hash" class="text-sm text-gray-600"></span>
                    <div class="flex gap-2">
                        <button id="select-all-btn"
                            class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                            Selecionar Todos
                        </button>
                        <button id="prev-btn"
                            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-400">
                            Anterior
                        </button>
                        <button id="next-btn"
                            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-400">
                            Próximo
                        </button>
                    </div>
                </div>
            </div>

            <div id="images-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                <!-- As imagens serão inseridas aqui dinamicamente -->
            </div>
        </div>
    </div>
    <script>
        const result = [];
        let hashQueue = [];
        var assets = {};
        let currentHashIndex = 0;
        let selectedItems = new Set(); // Para controle do toggle

        function render() {
            document.querySelector('#console').innerHTML = JSON.stringify(result, null, 2);
        }

        function processarDados(dados) {
            hashQueue = Object.keys(dados);
            if (hashQueue.length > 0) {
                currentHashIndex = 0;
                exibirHashAtual();
            }
        }
        function selecionarTodos() {
            const currentHash = hashQueue[currentHashIndex];
            const items = responseData[currentHash];
            const container = document.getElementById('images-container');

            items.forEach(item => {
                const itemKey = `${currentHash}-${item}`;

                // Se já não estiver selecionado, seleciona
                if (!selectedItems.has(itemKey)) {
                    selectedItems.add(itemKey);

                    // Encontrar o elemento do card e checkbox
                    const cards = container.querySelectorAll('.border.rounded-lg');
                    cards.forEach(card => {
                        const label = card.querySelector('span');
                        if (label && label.textContent === item) {
                            const checkbox = card.querySelector('div:last-child');

                            // Aplicar estilos de seleção
                            card.classList.remove('border-gray-200');
                            card.classList.add('border-blue-500', 'bg-blue-50');
                            checkbox.innerHTML = '✓';
                            checkbox.classList.add('bg-blue-500', 'border-blue-500', 'text-white');

                            // Adicionar ao result se não existir
                            const exists = result.some(entry =>
                                entry.hash === currentHash && entry.item === item
                            );
                            if (!exists) {
                                result.push({
                                    hash: currentHash,
                                    item: item,
                                    timestamp: new Date().toISOString()
                                });
                            }
                        }
                    });
                }
            });

            render();
        }

        function desselecionarTodos() {
            const currentHash = hashQueue[currentHashIndex];
            const items = responseData[currentHash];
            const container = document.getElementById('images-container');

            items.forEach(item => {
                const itemKey = `${currentHash}-${item}`;

                // Se estiver selecionado, desseleciona
                if (selectedItems.has(itemKey)) {
                    selectedItems.delete(itemKey);

                    // Encontrar o elemento do card e checkbox
                    const cards = container.querySelectorAll('.border.rounded-lg');
                    cards.forEach(card => {
                        const label = card.querySelector('span.symbol');
                        if (label && label.textContent === item) {
                            const checkbox = card.querySelector('div:last-child');

                            // Remover estilos de seleção
                            card.classList.remove('border-blue-500', 'bg-blue-50');
                            card.classList.add('border-gray-200');
                            checkbox.innerHTML = '';
                            checkbox.classList.remove('bg-blue-500', 'border-blue-500', 'text-white');

                            // Remover do result
                            const index = result.findIndex(entry =>
                                entry.hash === currentHash && entry.item === item
                            );
                            if (index > -1) {
                                result.splice(index, 1);
                            }
                        }
                    });
                }
            });

            render();
        }

        function exibirHashAtual() {
            const currentHash = hashQueue[currentHashIndex];
            const items = responseData[currentHash];

            // Atualizar o display da hash atual
            document.getElementById('current-hash').textContent =
                `Hash ${currentHashIndex + 1} de ${hashQueue.length}: ${currentHash.substring(0, 8)}...`;

            // Atualizar estado dos botões
            document.getElementById('prev-btn').disabled = currentHashIndex === 0;
            document.getElementById('next-btn').disabled = currentHashIndex === hashQueue.length - 1;

            // Limpar container de imagens
            const container = document.getElementById('images-container');
            container.innerHTML = '';

            // Adicionar cada item como uma imagem
            items.forEach(item => {
                const imgCard = document.createElement('div');
                imgCard.className = 'border rounded-lg p-3 flex flex-col items-center cursor-pointer hover:bg-gray-50 transition-colors';

                const img = document.createElement('img');
                img.src = `http://localhost:3000/files/logo/${item}.svg`;
                img.alt = item;
                img.className = 'w-16 h-16 object-contain mb-2';
                img.onerror = function () {
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0zMiAzNkMzNC4yMDkxIDM2IDM2IDM0LjIwOTEgMzYgMzJDMzYgMjkuNzkwOSAzNC4yMDkxIDI4IDMyIDI4QzI5Ljc5MDkgMjggMjggMjkuNzkwOSAyOCAzMkMyOCAzNC4yMDkxIDI5Ljc5MDkgMzYgMzIgMzZaIiBmaWxsPSIjOEE5MEFBIi8+CjxwYXRoIGQ9Ik0zMiAxOEMzMy4xMDQ2IDE4IDM0IDE4Ljg5NTQgMzQgMjBWMzJDMzQgMzMuMTA0NiAzMy4xMDQ2IDM0IDMyIDM0QzMwLjg5NTQgMzQgMzAgMzMuMTA0NiAzMCAzMlYyMEMzMCAxOC44OTU0IDMwLjg5NTQgMTggMzIgMThaIiBmaWxsPSIjOEE5MEFBIi8+Cjwvc3ZnPgo=';
                };

                const label = document.createElement('span');
                label.className = 'text-sm font-medium text-center symbol';
                label.textContent = item ; //`${item} - ${assets[item]}`;

                const label2 = document.createElement('span');
                label2.className = 'text-[6pt] font-medium text-center text-neutral-600';
                label2.textContent = assets[item];


                const checkbox = document.createElement('div');
                checkbox.className = 'mt-2 w-5 h-5 border-2 border-gray-400 rounded flex items-center justify-center';

                imgCard.appendChild(img);
                imgCard.appendChild(label);
                imgCard.appendChild(label2);
                imgCard.appendChild(checkbox);

                // Adicionar evento de clique para toggle
                imgCard.addEventListener('click', () => {
                    toggleSelecao(item, currentHash, imgCard, checkbox);
                });

                container.appendChild(imgCard);
            });
            atualizarBotaoSelecionarTodos();
        }

        function toggleSelecao(item, hash, cardElement, checkboxElement) {
            const itemKey = `${hash}-${item}`;

            if (selectedItems.has(itemKey)) {
                // Remover da seleção
                selectedItems.delete(itemKey);
                cardElement.classList.remove('border-blue-500', 'bg-blue-50');
                cardElement.classList.add('border-gray-200');
                checkboxElement.innerHTML = '';
                checkboxElement.classList.remove('bg-blue-500', 'border-blue-500');

                // Remover do result
                const index = result.findIndex(entry =>
                    entry.hash === hash && entry.item === item
                );
                if (index > -1) {
                    result.splice(index, 1);
                }
            } else {
                // Adicionar à seleção
                selectedItems.add(itemKey);
                cardElement.classList.remove('border-gray-200');
                cardElement.classList.add('border-blue-500', 'bg-blue-50');
                checkboxElement.innerHTML = '✓';
                checkboxElement.classList.add('bg-blue-500', 'border-blue-500', 'text-white');

                // Adicionar ao result
                result.push({
                    hash: hash,
                    item: item
                });
            }

            render();
        }

        function atualizarBotaoSelecionarTodos() {
            const selectAllBtn = document.getElementById('select-all-btn');
            const currentHash = hashQueue[currentHashIndex];
            const items = responseData[currentHash];

            if (items && items.length > 0) {
                const todosSelecionados = items.every(item =>
                    selectedItems.has(`${currentHash}-${item}`)
                );

                selectAllBtn.textContent = todosSelecionados ? 'Desselecionar Todos' : 'Selecionar Todos';
                selectAllBtn.className = todosSelecionados
                    ? 'px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600'
                    : 'px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600';
            }
        }

        // Navegação
        document.getElementById('prev-btn').addEventListener('click', () => {
            if (currentHashIndex > 0) {
                currentHashIndex--;
                exibirHashAtual();
            }
        });

        document.getElementById('next-btn').addEventListener('click', () => {
            if (currentHashIndex < hashQueue.length - 1) {
                currentHashIndex++;
                exibirHashAtual();
            }
        });

        document.getElementById('select-all-btn').addEventListener('click', () => {
            const currentHash = hashQueue[currentHashIndex];
            const items = responseData[currentHash];
            const todosSelecionados = items.every(item =>
                selectedItems.has(`${currentHash}-${item}`)
            );

            if (todosSelecionados) {
                desselecionarTodos();
            } else {
                selecionarTodos();
            }
        });

        // Atalhos de teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                document.getElementById('prev-btn').click();
            } else if (e.key === 'ArrowRight') {
                document.getElementById('next-btn').click();
            }
        });

        

        let responseData = {};
        fetch('/assets.json').then(async (response) => {
            assets = await response.json();
            let resp = await fetch('/ass.json');
            responseData = await resp.json();
            processarDados(responseData);
        })
    </script>
</body>

</html>